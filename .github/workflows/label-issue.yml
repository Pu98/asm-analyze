name: Label Issues

on:
  issues:
    types: [opened]

jobs:
  auto-label:
    runs-on: ubuntu-latest

    steps:
    - name: Check out the repository
      uses: actions/checkout@v4

    - name: Auto-label issues
      uses: actions/github-script@v7
      with:
        script: |
          const { issue } = context.payload;

          if (issue?.title && issue?.body) {
            const title = issue.title.toLowerCase();
            const body = issue.body.toLowerCase();
            const labels = [];

            const labelMapping = {
              'bug': 'bug',
              'feature': 'enhancement',
              'urgent': 'priority: high',
              'documentation': 'documentation'
              // todo: add more
            };

            for (const [keyword, label] of Object.entries(labelMapping)) {
              if (title.includes(keyword) || body.includes(keyword)) {
                labels.push(label);
              }
            }

            await github.rest.issues.addLabels({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: context.issue.number,
              labels
            });
          }