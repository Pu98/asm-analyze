name: Label Pull Requests

on:
  pull_request:
    types: [opened]

jobs:
  auto-label:
    runs-on: ubuntu-latest

    steps:
    - name: Check out the repository
      uses: actions/checkout@v4

    - name: Label pull requests
      uses: actions/github-script@v7
      with:
        script: |
          const { pull_request } = context.payload;

          if (pull_request?.title && pull_request?.body) {
            const title = pull_request.title.toLowerCase();
            const body = pull_request.body.toLowerCase();
            const labels = [];

            const labelMapping = {
              'bugfix': 'bug',
              'feature': 'enhancement',
              'urgent': 'priority: high',
              'docs': 'documentation'
              // todo: add more
            };

            for (const [keyword, label] of Object.entries(labelMapping)) {
              if (title.includes(keyword) || body.includes(keyword)) {
                labels.push(label);
              }
            }

            await github.rest.issues.addLabels({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: context.issue.number,
              labels
            });
          }